<!DOCTYPE html>
<html>
<head>
	<title>EaselJS demo: localToLocal</title>
	<link href="../_shared/demo.css" rel="stylesheet" type="text/css">
	<script src="http://code.createjs.com/easeljs-0.7.0.min.js"></script>
	<script>
		var stage, arm, dragger;
		function init() {

			stage = new createjs.Stage("demoCanvas");
			for (var i = 0; i < 2; i++) {
				var child = new createjs.Shape();
				child.graphics.beginFill("red").drawCircle(0,0,45);
				child.x = 100 + i*100;
				child.y = 100;
				child.id = i;
				// child.dominance = 5;

				var target = new createjs.Shape();
				target.graphics.beginFill("blue").drawCircle(0,0,45);
				target.x = 100 + i*100;
				target.y = 400;
				target.id = 10000-i;
				// target.dominance = 0;

				child.target = target;
				stage.addChild(child.target);
				stage.addChild(child);
				
				
				child.on("pressmove", function(evt) {
					snapOnCorrectObject(evt);
					snapOnAnyObject(evt);
				});
			var sortFunction = function(obj1, obj2, options) {
			    if (obj1.id > obj2.id) { return -1; }
			    if (obj1.id < obj2.id) { return 1; }
		    return 0;
		}
		    stage.sortChildren(sortFunction);
		    stage.update();
			}
			stage.update();
		}
		
		function snapOnCorrectObject(evt) {
			var myChild = evt.target;
			var myTarget = evt.target.target;
			evt.currentTarget.x = evt.stageX;
			evt.currentTarget.y = evt.stageY;
			var pt = myChild.localToLocal(10, 10, myTarget);
			if (myTarget.hitTest(pt.x, pt.y)) { 
				myTarget.alpha = 1; 
				myChild.setTransform(myTarget.x, myTarget.y);
				console.log('I am correct');
			}
			stage.update(); 
		}
		function snapOnAnyObject(evt) {
			var myChild = evt.target;
			evt.currentTarget.x = evt.stageX;
			evt.currentTarget.y = evt.stageY;
			for (var i = 0, size = stage.getNumChildren(); i < size; i++) {
				var myTarget = stage.getChildAt(i).target;
				if (myTarget == undefined) {
					continue;
				}
				var pt = myChild.localToLocal(10, 10, myTarget);
				if (myTarget.hitTest(pt.x, pt.y)) { 
					myTarget.alpha = 1; 
					myChild.setTransform(myTarget.x, myTarget.y);
				}
			}
			stage.update(); 
		}
		function tick(event) {
			stage.update(event);
		}
	</script>
</head>
<body onLoad="init();">
	<canvas id="demoCanvas" width="600" height="600">
		alternate content
	</canvas>
</body>
</html>